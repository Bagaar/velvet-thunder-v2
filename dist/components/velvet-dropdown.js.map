{"version":3,"file":"velvet-dropdown.js","sources":["../../src/components/velvet-dropdown.hbs","../../src/components/velvet-dropdown.ts"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{! @glint-nocheck }}\\n{{! Needs https://github.com/embroider-build/embroider/pull/1367 to remove `@glint-nocheck`. }}\\n\\n<div class=\\\"velvet-dropdown\\\" ...attributes>\\n  {{yield\\n    (hash\\n      Button=(component\\n        (ensure-safe-component this.VelvetButton)\\n        isDisclosure=true\\n        privateDropdownTrigger=this.trigger\\n      )\\n      Content=(component\\n        (ensure-safe-component this.VelvetDropdownContent)\\n        isShown=this.isShown\\n        modifier=this.content\\n      )\\n      IconButton=(component\\n        (ensure-safe-component this.VelvetIconButton)\\n        privateDropdownTrigger=this.trigger\\n      )\\n      isShown=this.isShown\\n      hide=this.hide\\n      show=this.show\\n      toggle=this.toggle\\n      content=this.content\\n      trigger=this.trigger\\n    )\\n  }}\\n</div>\")","import { assert } from \"@ember/debug\";\nimport {\n  autoUpdate,\n  computePosition,\n  flip,\n  offset,\n  Placement,\n  Strategy,\n} from \"@floating-ui/dom\";\nimport Component from \"@glimmer/component\";\nimport { tracked } from \"@glimmer/tracking\";\nimport type { ModifierLike, WithBoundArgs } from \"@glint/template\";\nimport { modifier } from \"ember-modifier\";\nimport VelvetButton from \"./velvet-button.ts\";\nimport VelvetDropdownContent from \"./velvet-dropdown/content.ts\";\nimport VelvetIconButton from \"./velvet-icon-button.ts\";\n\ninterface VelvetDropdownSignature {\n  Args: {\n    /// Offset of the content in pixels relative to the trigger.\n    /// @default [4]\n    offset?: number;\n    /// Placement of the content relative to the trigger.\n    /// @default [\"bottom-start\"]\n    placement?: Placement;\n    /// CSS position of the content.\n    /// @default [\"absolute\"]\n    strategy?: Strategy;\n  };\n  Blocks: {\n    default: [\n      {\n        Button: WithBoundArgs<\n          typeof VelvetButton,\n          \"privateDropdownTrigger\" | \"isDisclosure\" | \"variant\"\n        >;\n        Content: WithBoundArgs<\n          typeof VelvetDropdownContent,\n          \"isShown\" | \"modifier\"\n        >;\n        IconButton: WithBoundArgs<\n          typeof VelvetIconButton,\n          \"privateDropdownTrigger\" | \"variant\"\n        >;\n        isShown: boolean;\n        hide: () => void;\n        show: () => void;\n        toggle: () => void;\n        content: ModifierLike<ContentSignature>;\n        trigger: ModifierLike<TriggerSignature>;\n      }\n    ];\n  };\n  Element: HTMLDivElement;\n}\n\nexport interface ContentSignature {\n  Element: HTMLElement;\n}\n\nexport interface TriggerSignature {\n  Element: HTMLElement;\n}\n\nexport default class VelvetDropdown extends Component<VelvetDropdownSignature> {\n  @tracked isShown = false;\n\n  triggerElement: HTMLElement | null = null;\n  VelvetButton = VelvetButton;\n  VelvetDropdownContent: typeof VelvetDropdownContent = VelvetDropdownContent;\n  VelvetIconButton = VelvetIconButton;\n\n  get offset(): number {\n    const { offset } = this.args;\n\n    return typeof offset === \"number\" ? offset : 4;\n  }\n\n  get placement(): Placement {\n    return this.args.placement || \"bottom-start\";\n  }\n\n  get strategy(): Strategy {\n    return this.args.strategy || \"absolute\";\n  }\n\n  content = modifier<ContentSignature>((contentElement) => {\n    const { placement, strategy, triggerElement } = this;\n\n    assert(\"[VelvetDropdown] Trigger element must be present.\", triggerElement);\n\n    // https://floating-ui.com/docs/computeposition#initial-layout:\n    Object.assign(contentElement.style, {\n      left: 0,\n      position: strategy,\n      top: 0,\n    });\n\n    const updateFloating = async () => {\n      const { x, y } = await computePosition(triggerElement, contentElement, {\n        middleware: [flip(), offset(this.offset)],\n        placement,\n        strategy,\n      });\n\n      Object.assign(contentElement.style, { left: `${x}px`, top: `${y}px` });\n    };\n\n    const cleanupFloating = autoUpdate(\n      triggerElement,\n      contentElement,\n      updateFloating\n    );\n\n    const clickOutsideHandler = ({ target }: MouseEvent) => {\n      if (\n        target !== contentElement &&\n        target !== triggerElement &&\n        contentElement.contains(target as Node) === false &&\n        triggerElement.contains(target as Node) === false\n      ) {\n        this.hide();\n      }\n    };\n\n    const pressEscapeHandler = ({ key }: KeyboardEvent) => {\n      if (key === \"Escape\") {\n        this.hide();\n      }\n    };\n\n    document.addEventListener(\"click\", clickOutsideHandler);\n    document.addEventListener(\"keydown\", pressEscapeHandler);\n\n    return () => {\n      cleanupFloating();\n      document.removeEventListener(\"click\", clickOutsideHandler);\n      document.removeEventListener(\"keydown\", pressEscapeHandler);\n    };\n  });\n\n  trigger = modifier<TriggerSignature>((triggerElement) => {\n    this.triggerElement = triggerElement;\n\n    triggerElement.addEventListener(\"click\", this.toggle);\n\n    return () => triggerElement.removeEventListener(\"click\", this.toggle);\n  });\n\n  hide = () => {\n    this.isShown = false;\n  };\n\n  show = () => {\n    this.isShown = true;\n  };\n\n  toggle = () => {\n    if (this.isShown) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  };\n}\n"],"names":["VelvetDropdown","_class","Component","constructor","args","_initializerDefineProperty","_descriptor","_defineProperty","VelvetButton","VelvetDropdownContent","VelvetIconButton","modifier","contentElement","placement","strategy","triggerElement","assert","Object","assign","style","left","position","top","updateFloating","x","y","computePosition","middleware","flip","offset","cleanupFloating","autoUpdate","clickOutsideHandler","target","contains","hide","pressEscapeHandler","key","document","addEventListener","removeEventListener","toggle","isShown","show","_applyDecoratedDescriptor","prototype","tracked","configurable","enumerable","writable","initializer","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;;;;AACA,eAAe,kBAAkB,CAAC,izBAAizB;;;AC+D9zBA,IAAAA,cAAc,IAAAC,MAAA,GAApB,MAAMD,cAAc,SAASE,SAAS,CAA0B;AAAAC,EAAAA,WAAAA,CAAA,GAAAC,IAAA,EAAA;AAAA,IAAA,KAAA,CAAA,GAAAA,IAAA,CAAA,CAAA;AAAAC,IAAAA,0BAAA,kBAAAC,WAAA,EAAA,IAAA,CAAA,CAAA;AAAAC,IAAAA,eAAA,yBAGxC,IAAI,CAAA,CAAA;AAAAA,IAAAA,eAAA,uBAC1BC,YAAY,CAAA,CAAA;AAAAD,IAAAA,eAAA,gCAC2BE,qBAAqB,CAAA,CAAA;AAAAF,IAAAA,eAAA,2BACxDG,gBAAgB,CAAA,CAAA;AAAAH,IAAAA,eAAA,CAgBzBI,IAAAA,EAAAA,SAAAA,EAAAA,QAAQ,CAAoBC,cAAc,IAAK;MACvD,MAAM;QAAEC,SAAS;QAAEC,QAAQ;AAAEC,QAAAA,cAAAA;AAAe,OAAC,GAAG,IAAI,CAAA;AAEpDC,MAAAA,MAAM,CAAC,mDAAmD,EAAED,cAAc,CAAC,CAAA;;AAE3E;AACAE,MAAAA,MAAM,CAACC,MAAM,CAACN,cAAc,CAACO,KAAK,EAAE;AAClCC,QAAAA,IAAI,EAAE,CAAC;AACPC,QAAAA,QAAQ,EAAEP,QAAQ;AAClBQ,QAAAA,GAAG,EAAE,CAAA;AACP,OAAC,CAAC,CAAA;AAEF,MAAA,MAAMC,cAAc,GAAG,YAAY;QACjC,MAAM;UAAEC,CAAC;AAAEC,UAAAA,CAAAA;AAAE,SAAC,GAAG,MAAMC,eAAe,CAACX,cAAc,EAAEH,cAAc,EAAE;AACrEe,UAAAA,UAAU,EAAE,CAACC,IAAI,EAAE,EAAEC,MAAM,CAAC,IAAI,CAACA,MAAM,CAAC,CAAC;UACzChB,SAAS;AACTC,UAAAA,QAAAA;AACF,SAAC,CAAC,CAAA;AAEFG,QAAAA,MAAM,CAACC,MAAM,CAACN,cAAc,CAACO,KAAK,EAAE;UAAEC,IAAI,EAAG,CAAEI,EAAAA,CAAE,CAAG,EAAA,CAAA;UAAEF,GAAG,EAAG,GAAEG,CAAE,CAAA,EAAA,CAAA;AAAI,SAAC,CAAC,CAAA;OACvE,CAAA;MAED,MAAMK,eAAe,GAAGC,UAAU,CAChChB,cAAc,EACdH,cAAc,EACdW,cACF,CAAC,CAAA;MAED,MAAMS,mBAAmB,GAAGA,CAAC;AAAEC,QAAAA,MAAAA;AAAmB,OAAC,KAAK;QACtD,IACEA,MAAM,KAAKrB,cAAc,IACzBqB,MAAM,KAAKlB,cAAc,IACzBH,cAAc,CAACsB,QAAQ,CAACD,MAAc,CAAC,KAAK,KAAK,IACjDlB,cAAc,CAACmB,QAAQ,CAACD,MAAc,CAAC,KAAK,KAAK,EACjD;UACA,IAAI,CAACE,IAAI,EAAE,CAAA;AACb,SAAA;OACD,CAAA;MAED,MAAMC,kBAAkB,GAAGA,CAAC;AAAEC,QAAAA,GAAAA;AAAmB,OAAC,KAAK;QACrD,IAAIA,GAAG,KAAK,QAAQ,EAAE;UACpB,IAAI,CAACF,IAAI,EAAE,CAAA;AACb,SAAA;OACD,CAAA;AAEDG,MAAAA,QAAQ,CAACC,gBAAgB,CAAC,OAAO,EAAEP,mBAAmB,CAAC,CAAA;AACvDM,MAAAA,QAAQ,CAACC,gBAAgB,CAAC,SAAS,EAAEH,kBAAkB,CAAC,CAAA;AAExD,MAAA,OAAO,MAAM;AACXN,QAAAA,eAAe,EAAE,CAAA;AACjBQ,QAAAA,QAAQ,CAACE,mBAAmB,CAAC,OAAO,EAAER,mBAAmB,CAAC,CAAA;AAC1DM,QAAAA,QAAQ,CAACE,mBAAmB,CAAC,SAAS,EAAEJ,kBAAkB,CAAC,CAAA;OAC5D,CAAA;AACH,KAAC,CAAC,CAAA,CAAA;AAAA7B,IAAAA,eAAA,CAEQI,IAAAA,EAAAA,SAAAA,EAAAA,QAAQ,CAAoBI,cAAc,IAAK;MACvD,IAAI,CAACA,cAAc,GAAGA,cAAc,CAAA;MAEpCA,cAAc,CAACwB,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACE,MAAM,CAAC,CAAA;MAErD,OAAO,MAAM1B,cAAc,CAACyB,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAACC,MAAM,CAAC,CAAA;AACvE,KAAC,CAAC,CAAA,CAAA;AAAAlC,IAAAA,eAAA,eAEK,MAAM;MACX,IAAI,CAACmC,OAAO,GAAG,KAAK,CAAA;KACrB,CAAA,CAAA;AAAAnC,IAAAA,eAAA,eAEM,MAAM;MACX,IAAI,CAACmC,OAAO,GAAG,IAAI,CAAA;KACpB,CAAA,CAAA;AAAAnC,IAAAA,eAAA,iBAEQ,MAAM;MACb,IAAI,IAAI,CAACmC,OAAO,EAAE;QAChB,IAAI,CAACP,IAAI,EAAE,CAAA;AACb,OAAC,MAAM;QACL,IAAI,CAACQ,IAAI,EAAE,CAAA;AACb,OAAA;KACD,CAAA,CAAA;AAAA,GAAA;EA3FD,IAAId,MAAMA,GAAW;IACnB,MAAM;AAAEA,MAAAA,MAAAA;KAAQ,GAAG,IAAI,CAACzB,IAAI,CAAA;AAE5B,IAAA,OAAO,OAAOyB,MAAM,KAAK,QAAQ,GAAGA,MAAM,GAAG,CAAC,CAAA;AAChD,GAAA;EAEA,IAAIhB,SAASA,GAAc;AACzB,IAAA,OAAO,IAAI,CAACT,IAAI,CAACS,SAAS,IAAI,cAAc,CAAA;AAC9C,GAAA;EAEA,IAAIC,QAAQA,GAAa;AACvB,IAAA,OAAO,IAAI,CAACV,IAAI,CAACU,QAAQ,IAAI,UAAU,CAAA;AACzC,GAAA;AAgFF,CAAC,GAAAR,WAAA,GAAAsC,yBAAA,CAAA3C,MAAA,CAAA4C,SAAA,EAAA,SAAA,EAAA,CAnGEC,OAAO,CAAA,EAAA;EAAAC,YAAA,EAAA,IAAA;EAAAC,UAAA,EAAA,IAAA;EAAAC,QAAA,EAAA,IAAA;AAAAC,EAAAA,WAAA,cAAA;AAAA,IAAA,OAAW,KAAK,CAAA;AAAA,GAAA;AAAA,CAAA,CAAA,GAAAjD,MAAA,EAAA;AADSkD,oBAAA,CAAAC,QAAA,EAAApD,cAAA,CAAA;;;;"}