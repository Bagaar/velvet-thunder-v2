{"version":3,"file":"velvet-tooltip.js","sources":["../../src/components/velvet-tooltip.hbs","../../src/components/velvet-tooltip.ts"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{! @glint-nocheck }}\\n{{! Needs https://github.com/embroider-build/embroider/pull/1367 to remove `@glint-nocheck`. }}\\n\\n<div class=\\\"velvet-tooltip\\\" ...attributes>\\n  {{yield\\n    (hash\\n      Content=(component\\n        (ensure-safe-component this.VelvetTooltipContent)\\n        isShown=this.isShown\\n        modifier=this.content\\n      )\\n      isShown=this.isShown\\n      hide=this.hide\\n      show=this.show\\n      toggle=this.toggle\\n      content=this.content\\n      trigger=this.trigger\\n    )\\n  }}\\n</div>\")","import { assert } from \"@ember/debug\";\nimport { waitForPromise } from \"@ember/test-waiters\";\nimport {\n  autoUpdate,\n  computePosition,\n  flip,\n  offset,\n  Placement,\n  Strategy,\n} from \"@floating-ui/dom\";\nimport Component from \"@glimmer/component\";\nimport { tracked } from \"@glimmer/tracking\";\nimport type { ModifierLike, WithBoundArgs } from \"@glint/template\";\nimport { modifier } from \"ember-modifier\";\nimport VelvetTooltipContent from \"./velvet-tooltip/content.ts\";\n\ninterface VelvetTooltipSignature {\n  Args: {\n    /// Offset of the content in pixels relative to the trigger.\n    /// @default [4]\n    offset?: number;\n    /// Placement of the content relative to the trigger.\n    /// @default [\"top\"]\n    placement?: Placement;\n    /// Delay in milliseconds before showing the tooltip.\n    /// @default [400]\n    showDelay?: number;\n    /// CSS position of the content.\n    /// @default [\"absolute\"]\n    strategy?: Strategy;\n  };\n  Blocks: {\n    default: [\n      {\n        Content: WithBoundArgs<\n          typeof VelvetTooltipContent,\n          \"isShown\" | \"modifier\"\n        >;\n        isShown: boolean;\n        hide: () => void;\n        show: () => void;\n        toggle: () => void;\n        content: ModifierLike<ContentSignature>;\n        trigger: ModifierLike<TriggerSignature>;\n      }\n    ];\n  };\n  Element: HTMLDivElement;\n}\n\nexport interface ContentSignature {\n  Element: HTMLElement;\n}\n\nexport interface TriggerSignature {\n  Element: HTMLElement;\n}\n\nexport default class VelvetTooltip extends Component<VelvetTooltipSignature> {\n  @tracked isShown = false;\n\n  showTimeout: number | undefined = undefined;\n  triggerElement: HTMLElement | null = null;\n  VelvetTooltipContent: typeof VelvetTooltipContent = VelvetTooltipContent;\n\n  get offset(): number {\n    const { offset } = this.args;\n\n    return typeof offset === \"number\" ? offset : 4;\n  }\n\n  get placement(): Placement {\n    return this.args.placement || \"top\";\n  }\n\n  get showDelay(): number {\n    const { showDelay } = this.args;\n\n    return typeof showDelay === \"number\" ? showDelay : 400;\n  }\n\n  get strategy(): Strategy {\n    return this.args.strategy || \"absolute\";\n  }\n\n  content = modifier<ContentSignature>((contentElement) => {\n    const { placement, strategy, triggerElement } = this;\n\n    assert(\"[VelvetTooltip] Trigger element must be present.\", triggerElement);\n\n    // https://floating-ui.com/docs/computeposition#initial-layout:\n    Object.assign(contentElement.style, {\n      left: 0,\n      position: strategy,\n      top: 0,\n    });\n\n    const updateFloating = async () => {\n      const { x, y } = await computePosition(triggerElement, contentElement, {\n        middleware: [flip(), offset(this.offset)],\n        placement,\n        strategy,\n      });\n\n      Object.assign(contentElement.style, { left: `${x}px`, top: `${y}px` });\n    };\n\n    const cleanupFloating = autoUpdate(\n      triggerElement,\n      contentElement,\n      updateFloating\n    );\n\n    return cleanupFloating;\n  });\n\n  trigger = modifier<TriggerSignature>((triggerElement) => {\n    this.triggerElement = triggerElement;\n\n    triggerElement.addEventListener(\"mouseenter\", this.show);\n    triggerElement.addEventListener(\"mouseleave\", this.hide);\n\n    return () => {\n      triggerElement.removeEventListener(\"mouseenter\", this.show);\n      triggerElement.removeEventListener(\"mouseleave\", this.hide);\n    };\n  });\n\n  hide = () => {\n    clearTimeout(this.showTimeout);\n\n    this.isShown = false;\n  };\n\n  show = () => {\n    clearTimeout(this.showTimeout);\n\n    return waitForPromise(\n      new Promise<void>((resolve) => {\n        this.showTimeout = setTimeout(() => {\n          this.isShown = true;\n\n          resolve();\n        }, this.showDelay);\n      })\n    );\n  };\n\n  toggle = () => {\n    if (this.isShown) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  };\n}\n"],"names":["VelvetTooltip","_class","Component","constructor","args","_initializerDefineProperty","_descriptor","_defineProperty","undefined","VelvetTooltipContent","modifier","contentElement","placement","strategy","triggerElement","assert","Object","assign","style","left","position","top","updateFloating","x","y","computePosition","middleware","flip","offset","cleanupFloating","autoUpdate","addEventListener","show","hide","removeEventListener","clearTimeout","showTimeout","isShown","waitForPromise","Promise","resolve","setTimeout","showDelay","_applyDecoratedDescriptor","prototype","tracked","configurable","enumerable","writable","initializer","setComponentTemplate","TEMPLATE"],"mappings":"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"}